
library(dplyr)
library(tidyr)
library(stringr)

file_path <- ""
output_path <- ""

df <- read.csv(file_path)
df <- df %>%
  dplyr::rename(SID = subject) %>%
  dplyr::mutate(SID = stringr::str_replace(SID, "sub-", "MR"))

# extract global metrics 
global_df <- df %>%
  dplyr::filter(!is.na(modularity)) %>%        
  dplyr::select(SID, modularity, integration_global, segregation_global, density) %>%
  dplyr::distinct(SID, .keep_all = TRUE)       

# extract metrics by network
network_df <- df %>%
  dplyr::filter(!is.na(network)) %>%
  dplyr::select(SID, network, integration_network, segregation_network, density)

network_wide <- network_df %>%
  tidyr::pivot_wider(
    id_cols = SID,
    names_from = network,
    values_from = c(integration_network, segregation_network),
    names_glue = "{network}_{.value}"
  )


final_df <- global_df %>%
  dplyr::left_join(network_wide, by = "SID") %>%
  dplyr::distinct(SID, .keep_all = TRUE)
write.csv(final_df, output_path, row.names = FALSE)
